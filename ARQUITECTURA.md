# üèõÔ∏è Arquitectura del Sistema - SaludIA (MediTranslate)

## üìã √çndice

1. [Arquitectura General](#-arquitectura-general)
2. [Arquitectura de 3 Capas](#-arquitectura-de-3-capas)
3. [Arquitectura de Componentes](#-arquitectura-de-componentes)
4. [Diagrama de Despliegue](#-diagrama-de-despliegue)
5. [Flujo de Datos](#-flujo-de-datos)
6. [Stack Tecnol√≥gico](#-stack-tecnol√≥gico)
7. [Patrones de Dise√±o](#-patrones-de-dise√±o)

---

## üèóÔ∏è Arquitectura General

```mermaid
graph TB
    subgraph "Cliente (Navegador/PWA)"
        UI[React UI Components]
        Hooks[React Query Hooks]
        Router[Wouter Router]
        LocalStorage[LocalStorage<br/>JWT Token]
    end
    
    subgraph "Servidor (Render.com)"
        API[Express REST API]
        Auth[JWT Auth Middleware]
        Translator[Medical Translator<br/>ClinicalBERT-like]
        Storage[MemStorage<br/>In-Memory DB]
        FileHandler[Multer<br/>File Upload]
    end
    
    subgraph "Almacenamiento"
        TempFiles[/uploads/<br/>Archivos Temporales]
        Memory[(MemStorage<br/>Users, Diagnoses, etc.)]
    end
    
    subgraph "Servicios Externos"
        PDFParser[pdf-parse<br/>Extracci√≥n de texto]
        CSVParser[Node.js fs<br/>Lectura de CSV]
    end
    
    UI --> Hooks
    Hooks --> Router
    Hooks -->|HTTP/HTTPS| API
    Router --> UI
    
    API --> Auth
    Auth --> API
    API --> Translator
    API --> Storage
    API --> FileHandler
    
    FileHandler --> TempFiles
    FileHandler --> PDFParser
    FileHandler --> CSVParser
    
    PDFParser --> Translator
    CSVParser --> Translator
    
    Translator --> Storage
    Storage --> Memory
    
    UI -.->|Guarda Token| LocalStorage
    LocalStorage -.->|Env√≠a en Headers| API
    
    style UI fill:#e3f2fd
    style API fill:#fff3e0
    style Translator fill:#f3e5f5
    style Storage fill:#e8f5e9
```

---

## üìä Arquitectura de 3 Capas

```mermaid
graph TB
    subgraph "üé® Capa de Presentaci√≥n"
        direction TB
        Browser[Navegador Web / PWA]
        
        subgraph "React Frontend"
            Pages[Pages<br/>home.tsx, not-found.tsx]
            Components[Components<br/>TranslationForm, HealthDashboard,<br/>FileUpload, HistoryTab]
            UIComponents[UI Components<br/>shadcn/ui + Radix UI]
            Hooks[Custom Hooks<br/>useTranslations, useHealthData,<br/>useClinicalAnalysis, useAuth]
            State[Estado Global<br/>TanStack Query Client]
        end
        
        Browser --> Pages
        Pages --> Components
        Components --> UIComponents
        Components --> Hooks
        Hooks --> State
    end
    
    subgraph "‚öôÔ∏è Capa de L√≥gica de Negocio"
        direction TB
        
        subgraph "Express Server"
            Routes[Routes<br/>routes.ts]
            Controllers[Controllers<br/>Auth, Translation, File Upload]
            Middleware[Middleware<br/>authenticateToken, optionalAuth,<br/>multer upload]
        end
        
        subgraph "Servicios"
            AuthService[Auth Service<br/>JWT Generation & Validation]
            MedicalTranslator[Medical Translator<br/>NLP Medical Dictionary<br/>Pattern Matching<br/>Context Analysis]
            FileProcessor[File Processor<br/>PDF Parser<br/>CSV Reader]
        end
        
        Routes --> Controllers
        Controllers --> Middleware
        Controllers --> AuthService
        Controllers --> MedicalTranslator
        Controllers --> FileProcessor
    end
    
    subgraph "üíæ Capa de Datos"
        direction TB
        
        IStorage[IStorage Interface]
        MemStorage[MemStorage Implementation<br/>In-Memory Maps]
        
        subgraph "Modelos de Datos"
            Users[(Users)]
            Diagnoses[(Diagnoses)]
            HealthRecords[(Health Records)]
            ClinicalAnalyses[(Clinical Analyses)]
            QuickTranslations[(Quick Translations)]
        end
        
        IStorage --> MemStorage
        MemStorage --> Users
        MemStorage --> Diagnoses
        MemStorage --> HealthRecords
        MemStorage --> ClinicalAnalyses
        MemStorage --> QuickTranslations
    end
    
    State -->|HTTP Requests| Routes
    Controllers -->|CRUD Operations| IStorage
    MedicalTranslator -->|Save Results| IStorage
    FileProcessor -->|Save Analysis| IStorage
    
    style Browser fill:#e3f2fd
    style Routes fill:#fff3e0
    style MedicalTranslator fill:#f3e5f5
    style MemStorage fill:#e8f5e9
```

---

## üß© Arquitectura de Componentes

```mermaid
graph LR
    subgraph "Frontend (React + TypeScript)"
        direction TB
        
        App[App.tsx<br/>Root Component]
        
        subgraph "Pages"
            Home[HomePage<br/>Main Dashboard]
            NotFound[NotFoundPage<br/>404 Error]
        end
        
        subgraph "Feature Components"
            TransForm[TranslationForm<br/>Medical Translation UI]
            Dashboard[HealthDashboard<br/>Patient Data Display]
            FileUp[FileUpload<br/>PDF/CSV Upload]
            History[HistoryTab<br/>Translations & Analyses]
        end
        
        subgraph "UI Library"
            ShadCN[shadcn/ui<br/>Button, Card, Form, Dialog,<br/>Toast, Tabs, etc.]
        end
        
        subgraph "State Management"
            QueryClient[TanStack Query<br/>Server State Cache]
            LocalState[React State<br/>Component Local State]
        end
        
        App --> Home
        App --> NotFound
        Home --> TransForm
        Home --> Dashboard
        Home --> FileUp
        Home --> History
        
        TransForm --> ShadCN
        Dashboard --> ShadCN
        FileUp --> ShadCN
        History --> ShadCN
        
        TransForm --> QueryClient
        Dashboard --> QueryClient
        FileUp --> QueryClient
        History --> QueryClient
        
        TransForm --> LocalState
    end
    
    subgraph "Backend (Express + TypeScript)"
        direction TB
        
        Server[server/index.ts<br/>Express App]
        
        subgraph "API Layer"
            RouterModule[routes.ts<br/>API Endpoints]
            AuthMiddleware[auth.ts<br/>JWT Middleware]
        end
        
        subgraph "Business Logic"
            MedTranslator[medical-translator.ts<br/>Translation Engine]
            Dictionary[Medical Dictionary<br/>150+ t√©rminos]
            Patterns[Regex Patterns<br/>Medical Suffixes]
        end
        
        subgraph "Data Layer"
            StorageModule[storage.ts<br/>IStorage Interface]
            MemDB[MemStorage Class<br/>Map-based Storage]
        end
        
        Server --> RouterModule
        RouterModule --> AuthMiddleware
        RouterModule --> MedTranslator
        
        MedTranslator --> Dictionary
        MedTranslator --> Patterns
        MedTranslator --> StorageModule
        
        StorageModule --> MemDB
    end
    
    QueryClient -->|POST /api/translate| RouterModule
    QueryClient -->|POST /api/auth/login| RouterModule
    QueryClient -->|POST /api/upload-clinical-file| RouterModule
    QueryClient -->|GET /api/health-record| RouterModule
    
    style App fill:#e3f2fd
    style Server fill:#fff3e0
    style MedTranslator fill:#f3e5f5
    style MemDB fill:#e8f5e9
```

---

## üåê Diagrama de Despliegue

```mermaid
graph TB
    subgraph "Cliente (Dispositivo del Usuario)"
        direction TB
        
        subgraph "Navegadores"
            Chrome[Chrome/Edge<br/>Desktop]
            Mobile[Chrome/Safari<br/>Mobile]
            PWA[PWA Instalada<br/>Modo Standalone]
        end
        
        ServiceWorker[Service Worker<br/>Cach√© Offline]
        
        Chrome --> ServiceWorker
        Mobile --> ServiceWorker
        PWA --> ServiceWorker
    end
    
    subgraph "CDN / Static Hosting"
        StaticFiles[Archivos Est√°ticos<br/>HTML, CSS, JS, Icons]
        Manifest[manifest.json<br/>PWA Configuration]
    end
    
    subgraph "Render.com (Cloud Platform)"
        direction TB
        
        subgraph "Web Service"
            Node[Node.js Runtime<br/>v20.x]
            Express[Express Server<br/>Puerto 5000]
            Vite[Vite Dev Server<br/>Development Only]
        end
        
        subgraph "Almacenamiento Ef√≠mero"
            UploadsFolder[/uploads/<br/>Archivos Temporales<br/>Eliminados despu√©s del an√°lisis]
            Memory[MemStorage<br/>Datos en RAM<br/>Se pierden al reiniciar]
        end
        
        subgraph "Build Process"
            TSC[TypeScript Compiler]
            ViteBuild[Vite Build<br/>Bundler]
        end
        
        Node --> Express
        Node --> Vite
        Express --> UploadsFolder
        Express --> Memory
        
        TSC --> Express
        ViteBuild --> StaticFiles
    end
    
    subgraph "Servicios de Terceros"
        NPM[NPM Registry<br/>Dependencias]
        Git[GitHub<br/>Repositorio marco344444/SaludIA]
    end
    
    Chrome -->|HTTPS| Express
    Mobile -->|HTTPS| Express
    PWA -->|HTTPS| Express
    
    ServiceWorker -.->|Cach√©| StaticFiles
    
    Express -->|Sirve| StaticFiles
    Express -->|Sirve| Manifest
    
    Git -->|Deploy Autom√°tico| Node
    NPM -->|Instala paquetes| Node
    
    style Chrome fill:#e3f2fd
    style Express fill:#fff3e0
    style Memory fill:#e8f5e9
    style Git fill:#f3e5f5
```

### üìù Detalles del Despliegue

#### **Producci√≥n (Render.com)**
- **URL**: https://saludia.onrender.com
- **Tipo**: Web Service (Free Tier)
- **Build Command**: `npm run build`
- **Start Command**: `npm run start`
- **Environment**: Node.js 20.x
- **Auto-deploy**: S√≠ (desde main branch)

#### **Caracter√≠sticas**:
- ‚úÖ HTTPS autom√°tico con certificado SSL
- ‚úÖ Deploy autom√°tico al hacer push a GitHub
- ‚úÖ Logs en tiempo real
- ‚úÖ Health checks cada 5 minutos
- ‚ö†Ô∏è El servidor se duerme despu√©s de 15 min de inactividad (Free tier)
- ‚ö†Ô∏è MemStorage se reinicia con cada deploy (datos vol√°tiles)

---

## üîÑ Flujo de Datos

### Flujo 1: Traducci√≥n de Diagn√≥stico

```mermaid
sequenceDiagram
    autonumber
    actor User as üë§ Usuario
    participant UI as üé® TranslationForm
    participant Hook as üîó useTranslations
    participant API as ‚öôÔ∏è Express API
    participant Auth as üîê Auth Middleware
    participant Translator as üß† MedicalTranslator
    participant Storage as üíæ MemStorage
    
    User->>UI: Ingresa "hipertensi√≥n arterial"
    UI->>Hook: createTranslation.mutate(text)
    Hook->>API: POST /api/translate<br/>{originalText: "..."}
    
    API->>Auth: optionalAuth (verifica token)
    Auth-->>API: userId or null
    
    API->>Translator: translate(originalText)
    
    rect rgb(240, 240, 255)
        Note over Translator: Proceso de Traducci√≥n
        Translator->>Translator: analyzeContext()<br/>(detecta: cardiovascular)
        Translator->>Translator: extractMedicalTerms()<br/>(encuentra: "hipertensi√≥n arterial")
        Translator->>Translator: Busca en diccionario:<br/>"presi√≥n alta en las arterias"
        Translator->>Translator: postProcess()<br/>(mejora legibilidad)
        Translator->>Translator: Calcula confianza: 85%
    end
    
    Translator-->>API: MedicalTranslation<br/>{translatedText, confidence, terms}
    
    API->>Storage: createDiagnosis(data, userId)
    Storage-->>API: Diagnosis guardado
    
    API-->>Hook: Response 200 OK<br/>{id, originalText, translatedText, confidence}
    Hook-->>UI: Actualiza cache
    UI-->>User: Muestra traducci√≥n:<br/>"presi√≥n alta en las arterias"<br/>‚úì 85% confianza
```

---

### Flujo 2: An√°lisis de Archivo CSV

```mermaid
sequenceDiagram
    autonumber
    actor User as üë§ Usuario
    participant UI as üé® FileUpload
    participant Hook as üîó useClinicalAnalysis
    participant API as ‚öôÔ∏è Express API
    participant Multer as üì§ Multer Middleware
    participant FS as üìÅ File System
    participant Translator as üß† MedicalTranslator
    participant Storage as üíæ MemStorage
    
    User->>UI: Selecciona "signos-vitales.csv"
    User->>UI: Click "Analizar"
    UI->>Hook: uploadFile.mutate(file)
    Hook->>API: POST /api/upload-clinical-file<br/>FormData(clinicalFile)
    
    API->>Multer: Valida archivo<br/>(tipo, tama√±o)
    Multer->>FS: Guarda en /uploads/temp-123.csv
    FS-->>Multer: Ruta del archivo
    Multer-->>API: req.file.path
    
    API->>FS: readFileSync(path, 'utf8')
    FS-->>API: Contenido CSV como texto
    
    API->>Translator: analyzeClinicalFile(content, 'csv')
    
    rect rgb(240, 255, 240)
        Note over Translator: An√°lisis CSV
        Translator->>Translator: Detecta columnas:<br/>Presi√≥n Sist√≥lica, Glucosa, Peso
        Translator->>Translator: Procesa 20 filas
        Translator->>Translator: Calcula promedios:<br/>PA: 135/83 mmHg<br/>Glucosa: 149 mg/dL
        Translator->>Translator: Extrae medicamentos √∫nicos:<br/>["Enalapril 10mg", "Metformina"]
        Translator->>Translator: Genera resumen en texto simple
        Translator->>Translator: Confianza: 80%
    end
    
    Translator-->>API: ClinicalAnalysisResult<br/>{analysis, keyFindings, confidence}
    
    API->>Storage: createClinicalAnalysis(data)
    Storage-->>API: Analysis guardado
    
    API->>FS: unlink(filePath)<br/>(elimina temporal)
    FS-->>API: Archivo eliminado
    
    API-->>Hook: Response 200 OK<br/>{id, fileName, analysis, keyFindings}
    Hook-->>UI: Actualiza cache
    UI-->>User: Muestra an√°lisis con estad√≠sticas
```

---

## üõ†Ô∏è Stack Tecnol√≥gico

```mermaid
mindmap
    root((SaludIA<br/>Stack))
        Frontend
            React 18
                TypeScript
                Vite
                Wouter Router
            UI Library
                shadcn/ui
                Radix UI
                Tailwind CSS
                Lucide Icons
            State Management
                TanStack Query
                React Hook Form
                Zod Validation
        Backend
            Node.js 20
                Express.js
                TypeScript
                tsx Dev Runtime
            Authentication
                JWT jsonwebtoken
                bcryptjs
            File Processing
                multer
                pdf-parse
                papaparse legacy
        PWA
            Service Worker
            manifest.json
            Offline Support
            Installable
        Deployment
            Render.com
                Auto Deploy
                HTTPS SSL
                Logs
                Health Checks
        Tools
            Git & GitHub
            npm
            ESLint
            Prettier
```

---

## üì¶ Estructura de Directorios

```
SaludIA/
‚îú‚îÄ‚îÄ üìÅ client/                      # Frontend React
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ index.html              # HTML principal
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ public/                 # Archivos est√°ticos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ manifest.json       # PWA manifest
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ service-worker.js   # Service Worker
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üñºÔ∏è icon-192.png        # √çcono PWA 192x192
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üñºÔ∏è icon-512.png        # √çcono PWA 512x512
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ src/
‚îÇ       ‚îú‚îÄ‚îÄ üìÑ App.tsx             # Componente ra√≠z
‚îÇ       ‚îú‚îÄ‚îÄ üìÑ main.tsx            # Entry point
‚îÇ       ‚îú‚îÄ‚îÄ üìÑ index.css           # Estilos globales
‚îÇ       ‚îú‚îÄ‚îÄ üìÅ components/         # Componentes React
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ translation-form.tsx
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ health-dashboard.tsx
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ file-upload.tsx
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ history-tab.tsx
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ ui/             # shadcn/ui components
‚îÇ       ‚îú‚îÄ‚îÄ üìÅ hooks/              # Custom hooks
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ use-translations.tsx
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ use-health-data.tsx
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ use-clinical-analysis.tsx
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ use-toast.ts
‚îÇ       ‚îú‚îÄ‚îÄ üìÅ lib/                # Utilidades
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ queryClient.ts  # TanStack Query config
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ utils.ts        # Helpers (cn, etc.)
‚îÇ       ‚îî‚îÄ‚îÄ üìÅ pages/              # P√°ginas
‚îÇ           ‚îú‚îÄ‚îÄ üìÑ home.tsx        # Dashboard principal
‚îÇ           ‚îî‚îÄ‚îÄ üìÑ not-found.tsx   # 404
‚îÇ
‚îú‚îÄ‚îÄ üìÅ server/                      # Backend Express
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ index.ts                # Server principal
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ routes.ts               # API endpoints
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ auth.ts                 # JWT middleware
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ medical-translator.ts   # Motor de traducci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ storage.ts              # MemStorage
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ vite.ts                 # Vite dev server
‚îÇ
‚îú‚îÄ‚îÄ üìÅ shared/                      # C√≥digo compartido
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ schema.ts               # Schemas Drizzle + Zod
‚îÇ
‚îú‚îÄ‚îÄ üìÅ uploads/                     # Archivos temporales
‚îÇ   ‚îî‚îÄ‚îÄ (archivos CSV/PDF temporales)
‚îÇ
‚îú‚îÄ‚îÄ üìÑ package.json                # Dependencias
‚îú‚îÄ‚îÄ üìÑ tsconfig.json               # TypeScript config
‚îú‚îÄ‚îÄ üìÑ vite.config.ts              # Vite config
‚îú‚îÄ‚îÄ üìÑ tailwind.config.ts          # Tailwind config
‚îú‚îÄ‚îÄ üìÑ drizzle.config.ts           # Drizzle ORM config
‚îú‚îÄ‚îÄ üìÑ DIAGRAMA-CLASES.md          # Diagrama de clases
‚îú‚îÄ‚îÄ üìÑ CASOS-DE-USO.md             # Casos de uso
‚îî‚îÄ‚îÄ üìÑ ARQUITECTURA.md             # Este documento
```

---

## üéØ Patrones de Dise√±o Utilizados

### 1. **Repository Pattern**
```typescript
// Interfaz que define el contrato
interface IStorage {
  createUser(data: InsertUser): Promise<User>;
  getUser(id: string): Promise<User | undefined>;
  // ... m√°s m√©todos
}

// Implementaci√≥n en memoria
class MemStorage implements IStorage {
  private users = new Map<string, User>();
  // ... implementaci√≥n
}
```
**Beneficio**: Abstracci√≥n de la capa de datos. F√°cil cambiar a PostgreSQL sin tocar la l√≥gica.

---

### 2. **Middleware Pattern**
```typescript
// Middleware de autenticaci√≥n
export const authenticateToken = (
  req: AuthRequest, 
  res: Response, 
  next: NextFunction
) => {
  const token = req.headers.authorization?.split(' ')[1];
  if (!token) return res.status(401).json({...});
  
  jwt.verify(token, SECRET, (err, user) => {
    if (err) return res.status(403).json({...});
    req.userId = user.id;
    next(); // ‚úÖ Contin√∫a al siguiente handler
  });
};
```
**Beneficio**: Separaci√≥n de concerns. Reutilizable en m√∫ltiples rutas.

---

### 3. **Strategy Pattern**
```typescript
// Diferentes estrategias de an√°lisis seg√∫n el tipo
class MedicalTranslator {
  analyzeClinicalFile(content: string, fileType: 'pdf' | 'csv') {
    if (fileType === 'csv') {
      return this.analyzeCSV(content);  // Estrategia CSV
    } else {
      return this.analyzePDF(content);  // Estrategia PDF
    }
  }
}
```
**Beneficio**: F√°cil agregar nuevos tipos de archivo (Excel, DICOM, etc.)

---

### 4. **Singleton Pattern**
```typescript
// Instancia √∫nica del traductor
export const medicalTranslator = new MedicalTranslator();

// Instancia √∫nica del storage
export const storage = new MemStorage();
```
**Beneficio**: Una sola instancia compartida en toda la app.

---

### 5. **Hook Pattern (React)**
```typescript
// Custom hook que encapsula l√≥gica de estado
export function useTranslations() {
  const queryClient = useQueryClient();
  
  const translationHistory = useQuery<Diagnosis[]>({
    queryKey: ["/api/diagnoses"],
  });
  
  const createTranslation = useMutation({
    mutationFn: async (data: { originalText: string }) => {
      const response = await apiRequest("POST", "/api/translate", data);
      return response.json();
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["/api/diagnoses"] });
    },
  });
  
  return { translationHistory, createTranslation };
}
```
**Beneficio**: Reutilizaci√≥n de l√≥gica entre componentes. Testing m√°s f√°cil.

---

### 6. **Factory Pattern (Impl√≠cito)**
```typescript
// Zod schemas act√∫an como factories de validaci√≥n
export const insertUserSchema = createInsertSchema(users, {
  email: z.string().email("Email inv√°lido"),
  password: z.string().min(8, "M√≠nimo 8 caracteres"),
}).omit({ id: true, createdAt: true });

// Uso
const validatedData = insertUserSchema.parse(req.body);
```
**Beneficio**: Validaci√≥n centralizada y reutilizable.

---

## üìä Escalabilidad y Mejoras Futuras

### Limitaciones Actuales:

| Aspecto | Limitaci√≥n | Impacto |
|---------|-----------|---------|
| **Storage** | MemStorage (RAM) | ‚ùå Datos se pierden al reiniciar |
| **Concurrencia** | Render Free Tier | ‚ö†Ô∏è 1 instancia, ~512MB RAM |
| **Archivos** | Almacenamiento ef√≠mero | ‚ùå No se guardan permanentemente |
| **Traducci√≥n** | Diccionario est√°tico | ‚ö†Ô∏è 150 t√©rminos, sin aprendizaje |

---

### Roadmap de Mejoras:

```mermaid
timeline
    title Roadmap de Arquitectura
    
    section Fase 1 (Actual)
        MemStorage en RAM : PWA Offline : Deploy en Render Free
    
    section Fase 2 (Q1 2026)
        PostgreSQL en Neon : JWT con refresh tokens : Redis para cach√©
    
    section Fase 3 (Q2 2026)
        AWS S3 para archivos : CloudFront CDN : Docker containers
    
    section Fase 4 (Q3 2026)
        Microservicios : Real AI/ML model : Kubernetes orchestration
```

---

### Migraci√≥n a PostgreSQL (Propuesta):

```mermaid
graph LR
    subgraph "Actual (MemStorage)"
        MemDB[(MemStorage<br/>RAM)]
    end
    
    subgraph "Futuro (PostgreSQL)"
        Neon[(Neon Postgres<br/>Serverless)]
        Drizzle[Drizzle ORM]
        Migrations[Migrations]
    end
    
    MemDB -.->|Migraci√≥n| Drizzle
    Drizzle --> Neon
    Migrations --> Neon
    
    style MemDB fill:#ffcccb
    style Neon fill:#90ee90
```

**C√≥digo ya preparado**:
- ‚úÖ `drizzle.config.ts` configurado
- ‚úÖ Schemas con `drizzle-orm/pg-core`
- ‚úÖ Solo falta cambiar implementaci√≥n de `IStorage`

---

## üîí Seguridad

### Capas de Seguridad Implementadas:

```mermaid
graph TD
    A[Cliente] -->|1. HTTPS| B[Render SSL]
    B -->|2. JWT Token| C[Auth Middleware]
    C -->|3. bcrypt hash| D[Password Storage]
    D -->|4. Zod Validation| E[Input Sanitization]
    E -->|5. CORS| F[API Protection]
    
    style B fill:#90ee90
    style C fill:#90ee90
    style D fill:#90ee90
    style E fill:#90ee90
    style F fill:#90ee90
```

1. **HTTPS Obligatorio**: Render proporciona SSL autom√°tico
2. **JWT Authentication**: Tokens con expiraci√≥n de 24h
3. **Password Hashing**: bcrypt con salt rounds = 10
4. **Input Validation**: Zod schemas en todas las rutas
5. **CORS Configurado**: Solo origins permitidos
6. **XSS Protection**: React escapa HTML autom√°ticamente
7. **File Upload Limits**: 10MB m√°ximo, solo PDF/CSV

---

## üìà M√©tricas de Performance

### Tiempos de Respuesta (Promedio):

| Endpoint | Tiempo | Cach√© | Optimizaci√≥n |
|----------|--------|-------|--------------|
| `POST /api/translate` | 150ms | ‚ùå | Diccionario en memoria |
| `POST /api/upload-clinical-file` | 2-4s | ‚ùå | Depende del tama√±o |
| `GET /api/health-record` | 50ms | ‚úÖ TanStack Query | MemStorage r√°pido |
| `POST /api/auth/login` | 200ms | ‚ùå | bcrypt compare |
| Assets est√°ticos | 10ms | ‚úÖ Service Worker | Vite bundling |

---

## üé® Decisiones de Arquitectura (ADRs)

### ADR-001: ¬øPor qu√© MemStorage en lugar de PostgreSQL?

**Contexto**: MVP necesita deployment r√°pido sin complejidad de DB.

**Decisi√≥n**: Usar MemStorage (Map en RAM) temporalmente.

**Consecuencias**:
- ‚úÖ **Pros**: Deploy instant√°neo, sin costos adicionales, r√°pido en desarrollo
- ‚ùå **Cons**: Datos vol√°tiles, no escala, se pierde al reiniciar

**Status**: Temporal ‚Üí Migrar a PostgreSQL en Fase 2

---

### ADR-002: ¬øPor qu√© TanStack Query en lugar de Redux?

**Contexto**: Necesidad de gestionar estado del servidor (API calls).

**Decisi√≥n**: Usar TanStack Query (React Query) para server state.

**Consecuencias**:
- ‚úÖ **Pros**: Cach√© autom√°tico, refetch inteligente, menos boilerplate
- ‚úÖ **Pros**: Optimistic updates, retry logic, invalidaci√≥n declarativa
- ‚ùå **Cons**: No sirve para estado cliente (se complementa con useState)

**Status**: Permanente

---

### ADR-003: ¬øPor qu√© diccionario est√°tico en lugar de ML/AI real?

**Contexto**: Traducci√≥n m√©dica requiere precisi√≥n pero MVP tiene restricciones.

**Decisi√≥n**: Diccionario + patrones regex en lugar de modelo ML.

**Consecuencias**:
- ‚úÖ **Pros**: Sin dependencia de APIs externas, funciona offline, predecible
- ‚úÖ **Pros**: Latencia <200ms, sin costos adicionales
- ‚ùå **Cons**: Limitado a 150 t√©rminos, no aprende, falsos negativos

**Status**: Temporal ‚Üí Integrar OpenAI/Gemini en Fase 3

---

## üìö Referencias

- [Express.js Best Practices](https://expressjs.com/en/advanced/best-practice-security.html)
- [React Architecture Patterns](https://react.dev/learn/thinking-in-react)
- [TanStack Query Docs](https://tanstack.com/query/latest)
- [Drizzle ORM](https://orm.drizzle.team/)
- [PWA Best Practices](https://web.dev/explore/progressive-web-apps)

---

**Generado autom√°ticamente para el proyecto SaludIA (MediTranslate)**  
*√öltima actualizaci√≥n: 21 de octubre de 2025*  
*Versi√≥n: 1.0.0*
